<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🦖 DinoDesk (Your Dino Personal Assistant) 🌿</title>
    <style>
        /* --- Root Variables for Cute Dino Theme (with Turquoise accent) --- */
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Balsamiq+Sans:wght@400;700&display=swap');

        :root {
            --font-main: 'Balsamiq Sans', cursive; /* Playful, friendly handwritten style */
            --font-secondary: 'Fredoka One', cursive; /* Bold, blocky, impactful for titles */
            --bg-main: #ffebee; /* Soft, light pink */
            --bg-section: #fff8e1; /* Pale yellow */
            --text-dark: #4a148c; /* Deep purple */
            --text-light: #ce93d8; /* Muted lavender */
            --accent-primary: #ffcdb2; /* Light peach */
            --accent-secondary: #f0f4c3; /* Soft lime */
            --accent-highlight: #e1bee7; /* Light lilac */
            --color-success: #81c784; /* Minty green */
            --color-danger: #e57373; /* Gentle red */
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.15); /* Soft, subtle shadow */
            --border-radius: 25px; /* Rounded corners for all elements */
            --color-turquoise: #40E0D0; /* Added Turquoise color for bounce */
        }

        /* --- Global Styles --- */
        * {
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            margin: 0;
            padding: 2.5rem;
            background-color: var(--bg-main);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow-x: hidden;
        }

        /* --- T-Rex Background Pseudo-element --- */
        body::before {
            content: '';
            position: fixed;
            top: 50%;
            left: -100px;
            transform: translateY(-50%) rotate(-10deg);
            width: 1000px;
            height: 1000px;
            background-image: url('http://googleusercontent.com/image_generation_content/2'); /* Original T-Rex image */
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.2;
            z-index: -1;
            filter: grayscale(30%) brightness(110%) saturate(180%);
        }


        /* --- Main Content Layout --- */
        .main-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2.5rem;
            max-width: 1600px;
            width: 100%;
            margin-top: 2.5rem;
            position: relative;
            z-index: 1;
        }

        /* --- Main Title Styling --- */
        .main-title {
            grid-column: 1 / -1;
            text-align: center;
            font-family: var(--font-secondary);
            text-shadow: 6px 6px 0px var(--text-dark),
                         8px 8px 0px var(--color-success);
            margin-bottom: 3rem;
            letter-spacing: 4px;
            line-height: 1.1;
        }

        .main-title .dino-name {
            font-size: 4.5rem;
            display: block;
            /* Bouncing and color change animation */
            animation: bounce-color-change 2s infinite alternate ease-in-out;
            color: var(--accent-primary); /* Initial color is primary accent (light peach) */
        }

        .main-title .assistant-tagline {
            font-size: 2rem;
            display: block;
            margin-top: 0.5rem;
            color: var(--text-dark);
            text-shadow: none;
            letter-spacing: 2px;
        }

        /* Keyframes for bouncing and color changing effect */
        @keyframes bounce-color-change {
            0% {
                transform: translateY(0);
                color: var(--accent-primary); /* Starts as primary accent */
            }
            50% {
                transform: translateY(-15px); /* Bounce up */
                color: var(--color-turquoise); /* Changes to turquoise at peak */
            }
            100% {
                transform: translateY(0);
                color: var(--accent-primary); /* Returns to primary accent */
            }
        }

        /* --- Section Box Styling (Task, Budget, Notes Modules) --- */
        .section {
            background: var(--bg-section);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            border: 4px solid var(--accent-secondary);
        }

        h2 {
            font-family: var(--font-secondary);
            margin-top: 0;
            color: var(--text-dark);
            border-bottom: 5px solid var(--text-light);
            padding-bottom: 1.2rem;
            margin-bottom: 2rem;
            font-size: 2.2rem;
            text-align: center;
            letter-spacing: 1px;
        }

        /* --- Form Elements Styling --- */
        input, textarea, button, select {
            font-family: var(--font-main);
            font-size: 1.15rem;
            padding: 1.2rem;
            margin-bottom: 1.2rem;
            border-radius: 18px;
            border: 2px solid var(--text-light);
            width: 100%;
            transition: all 0.3s ease;
            background-color: #f8fcf8;
            color: var(--text-dark);
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 12px var(--accent-primary);
        }

        button {
            background-color: var(--accent-primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
            padding: 1.3rem;
        }

        button:hover {
            opacity: 0.9;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        }

        /* --- List Styles --- */
        ul {
            list-style: none;
            padding: 0;
            flex-grow: 1;
            margin-bottom: 0;
        }

        li {
            background: #fce4ec; /* Light pink background for list items */
            margin-bottom: 1rem;
            padding: 1.4rem;
            border-radius: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            word-break: break-word;
            border: 1px solid #f8bbd0; /* Soft pink border */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        li.completed span {
            text-decoration: line-through;
            opacity: 0.6;
            color: var(--text-light);
        }

        li.important {
            background-color: var(--accent-highlight);
            border-left: 8px solid var(--accent-primary);
            box-shadow: 0 8px 18px rgba(255, 171, 145, 0.4);
        }

        /* --- Calendar/Time Display --- */
        .datetime-display {
            width: 100%;
            max-width: 1400px;
            background-color: var(--accent-secondary);
            color: var(--text-dark);
            text-align: center;
            padding: 1.8rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            font-style: italic;
            border: 4px solid var(--color-success);
            line-height: 1.4;
        }

        #currentDate {
            display: block;
            margin-bottom: 0.2em;
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-dark);
            font-family: var(--font-secondary);
        }
        #currentTime {
            font-size: 2.8rem;
            display: block;
            font-weight: 800;
            color: var(--text-dark);
            font-family: var(--font-secondary);
        }
        .datetime-display .emoji {
            font-size: 1.2em;
            margin: 0 0.5em;
        }


        /* --- Delete Button Styling --- */
        .delete-btn {
            background: none;
            border: none;
            color: var(--color-danger);
            font-size: 2.2rem;
            cursor: pointer;
            padding: 10px;
            min-width: 45px;
            transition: transform 0.2s ease;
        }

        .delete-btn:hover {
            transform: scale(1.3) rotate(15deg);
        }

        /* --- Budget Specifics --- */
        .budget-entry {
            display: grid;
            grid-template-columns: 1fr auto auto;
            align-items: center;
            gap: 20px;
            width: 100%;
        }

        .budget-desc {
            font-weight: 700;
            font-size: 1.3em;
            color: var(--text-dark);
        }

        .budget-category {
            font-size: 1em;
            background: var(--accent-highlight);
            padding: 6px 12px;
            border-radius: 12px;
            color: var(--text-dark);
            font-weight: 600;
        }

        .budget-amount.income {
            color: var(--color-success);
            font-weight: 800;
            font-size: 1.2em;
        }

        .budget-amount.expense {
            color: var(--color-danger);
            font-weight: 800;
            font-size: 1.2em;
        }

        .budget-totals {
            margin-top: 2.5rem;
            padding-top: 2.5rem;
            border-top: 4px solid var(--accent-primary);
            display: flex;
            justify-content: space-around;
            text-align: center;
            font-size: 1.3rem;
        }

        /* Smaller font for Gained, Spent, Balance */
        .total-value {
            font-weight: 900;
            display: block;
            font-size: 1.3em;
            margin-top: 8px;
        }

        #totalIncome {
            color: var(--color-success);
        }

        #totalExpense {
            color: var(--color-danger);
        }

        #finalBalance {
            color: var(--text-dark);
        }

        /* --- Task Specifics --- */
        .task-filters {
            display: flex;
            gap: 1.2rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .task-filters button {
            width: auto;
            flex-grow: 1;
            background: #e8f5e9; /* Light background for filter buttons */
            color: var(--text-dark);
            border: 2px solid var(--text-light);
            padding: 1rem 1.4rem;
            font-size: 1.05rem;
        }

        .task-filters button.active {
            background: var(--accent-secondary);
            color: var(--text-dark);
            border-color: var(--accent-secondary);
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-grow: 1;
        }

        .task-item input[type="checkbox"] {
            width: 28px;
            height: 28px;
            accent-color: var(--color-success);
            border-radius: 6px;
        }

        .task-details {
            font-size: 0.95em;
            color: var(--text-light);
            margin-top: 5px;
            display: block;
        }

        /* --- Notes Specifics --- */
        .note-item {
            flex-direction: column;
            align-items: flex-start;
        }

        .note-title {
            font-weight: 700;
            margin-bottom: 12px;
            font-size: 1.4rem;
            color: var(--text-dark);
        }

        .note-content {
            font-size: 1.15rem;
            line-height: 1.8;
            color: var(--text-dark);
        }

        /* --- Form Grouping --- */
        .form-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .form-group.vertical {
            flex-direction: column;
            gap: 1.5rem;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 1.5rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: 28px;
            height: 28px;
            margin: 0;
            accent-color: var(--accent-primary);
            border-radius: 6px;
        }

        .checkbox-group label {
            font-weight: 600;
            color: var(--text-dark);
            cursor: pointer;
            font-size: 1.15rem;
        }

        /* --- Responsive Adjustments --- */
        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 1.5rem;
            }

            .main-title .dino-name {
                font-size: 3.5rem;
            }
            .main-title .assistant-tagline {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 2rem;
            }

            .section {
                padding: 1.8rem;
            }

            .datetime-display {
                font-size: 1.2rem;
                padding: 1.5rem;
            }

            #currentDate {
                font-size: 1.6rem;
            }
            #currentTime {
                font-size: 2.2rem;
            }

            .budget-entry {
                grid-template-columns: 1fr;
            }

            .budget-category {
                grid-column: auto;
                text-align: center;
            }

            body::before {
                display: none;
            }
        }

        /* --- Dino Dashboard Styles --- */
        .dashboard {
            grid-column: 1 / -1;
            background: var(--bg-section);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-top: 2.5rem;
        }

        .dashboard-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .dashboard-item {
            background: #fff;
            padding: 1.8rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
        }

        .dashboard-item h3 {
            font-family: var(--font-secondary);
            color: var(--text-dark);
            margin-bottom: 1.2rem;
            font-size: 1.8rem;
            border-bottom: 3px solid var(--accent-primary);
            padding-bottom: 0.5rem;
        }

        /* --- Chart.js Styles (for Budget Overview chart) --- */
        /* Ensure canvas is responsive and fits well within its container */
        #budgetChart {
            max-width: 100% !important;
            height: auto !important;
        }

        /* --- Theme Customization --- */
        .theme-switcher {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .theme-switcher h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-dark);
        }

        .theme-switcher select {
            font-family: var(--font-main);
            font-size: 1.15rem;
            padding: 1rem;
            border-radius: 18px;
            border: 2px solid var(--text-light);
            background-color: #f8fcf8;
            color: var(--text-dark);
            transition: all 0.3s ease;
        }

        .theme-switcher select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 12px var(--accent-primary);
        }

        /* --- Data Visualization --- */
        .data-visualization {
            grid-column: 1 / -1;
            background: var(--bg-section);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-top: 2.5rem;
        }

        .data-visualization h2 {
            font-family: var(--font-secondary);
            color: var(--text-dark);
            margin-bottom: 1.5rem;
            font-size: 2rem;
            text-align: center;
        }

        canvas {
            max-width: 100% !important;
            height: auto !important;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>

<h1 class="main-title">
    <span class="dino-name">🦖 DinoDesk 🌿</span>
    <span class="assistant-tagline">(Your Dino Personal Assistant)</span>
</h1>

<!-- Calendar and Time Display -->
<div class="datetime-display">
    <span id="currentDate"><span class="emoji">📅</span></span>
    <span id="currentTime"><span class="emoji">⏰</span></span>
</div>

<div class="main-container">
    <!-- --- Task Management Module --- -->
    <div class="section">
        <h2>🌿 Task Jungle</h2>
        <div class="form-group vertical">
            <input type="text" id="taskInput" placeholder="Hunt for a new task... 🍖" />
            <div class="form-group">
                <input type="date" id="taskDate" />
                <input type="time" id="taskTime" />
            </div>
            <select id="taskCategory" required>
                <option value="">Select Category 🏷️</option>
                <option value="Foraging">Foraging</option>
                <option value="Territory">Territory Defense</option>
                <option value="Nest">Nest Building</option>
                <option value="Play">Playtime</option>
                <option value="Other">Other Primal Duty</option>
            </select>
            <div class="checkbox-group">
                <input type="checkbox" id="taskImportant" />
                <label for="taskImportant">Alpha Task? 👑</label>
            </div>
            <button onclick="addTask()">Stomp on it! 🦖</button>
        </div>
        <div class="task-filters">
            <button id="filterAll" class="active" onclick="filterTasks('all')">All Expeditions</button>
            <button id="filterActive" onclick="filterTasks('active')">Still Roaming</button>
            <button id="filterCompleted" onclick="filterTasks('completed')">Conquered! 🔥</button>
        </div>
        <ul id="taskList"></ul>
        <!-- Completion statistics -->
        <div id="completionStats" style="text-align: center; margin-top: 1rem; font-weight: 600;"></div>
    </div>

    <!-- --- Budget Tracker Module --- -->
    <div class="section">
        <h2>💎 Dino Budget</h2>
        <div class="form-group vertical">
            <input type="text" id="budgetDesc" placeholder="What shiny fossil did you find? (e.g., Rare Amber)" />
            <input type="text" id="budgetCategory" placeholder="Fortune Type (e.g., Foraging, Nest Building)" />
            <div class="form-group">
                <input type="number" id="budgetAmount" placeholder="Amount (e.g., 5.00 glimmering geodes)" />
                <select id="budgetType">
                    <option value="expense">Spent (Uh oh! 😩)</option>
                    <option value="income">Gained! (Cha-ching! ✨)</option>
                </select>
            </div>
            <button onclick="addBudget()">Unearth Fortune! ⛏️</button>
        </div>
        <ul id="budgetList"></ul>
        <div class="budget-totals">
            <div>Gained!<span id="totalIncome" class="total-value">$0.00</span></div>
            <div>Spent!<span id="totalExpense" class="total-value">$0.00</span></div>
            <div>Balance<span id="finalBalance" class="total-value">$0.00</span></div>
        </div>
        <!-- Monthly budget goals -->
        <div id="budgetGoals" style="text-align: center; margin-top: 1rem; font-weight: 600;"></div>
    </div>

    <!-- --- Notes Module --- -->
    <div class="section">
        <h2>📜 Dino Notes</h2>
        <div class="form-group vertical">
            <input type="text" id="noteTitle" placeholder="A scroll title... (e.g., Best digging spots)" />
            <textarea id="noteContent" placeholder="Scribe your ancient wisdom here... ✍️" rows="6"></textarea>
            <div class="checkbox-group">
                <input type="checkbox" id="noteImportant" />
                <label for="noteImportant">Legendary Lore? 🌟</label>
            </div>
            <button onclick="addNote()">Scribe Scroll! 📝</button>
        </div>
        <ul id="noteList"></ul>
    </div>

    <!-- --- Dino Dashboard Section --- -->
    <div class="section dashboard">
        <h2>🦖 Dino Dashboard</h2>
        <div class="dashboard-content">
            <!-- Upcoming Tasks -->
            <div class="dashboard-item">
                <h3>Upcoming Tasks</h3>
                <ul id="upcomingTasks"></ul>
            </div>

            <!-- Budget Overview -->
            <div class="dashboard-item">
                <h3>Budget Overview</h3>
                <canvas id="budgetChart" width="400" height="200"></canvas>
            </div>

            <!-- Recent Notes -->
            <div class="dashboard-item">
                <h3>Recent Notes</h3>
                <ul id="recentNotes"></ul>
            </div>

            <!-- Daily Recommendations -->
            <div class="dashboard-item">
                <h3>Daily Recommendations</h3>
                <p id="dailyRecommendations">🌟 Stay focused and conquer your tasks!</p>
            </div>
        </div>
    </div>

    <!-- --- Theme Customization --- -->
    <div class="theme-switcher">
        <h2>🎨 Theme Customization</h2>
        <select id="themeSelector" onchange="applyTheme(this.value)">
            <option value="dino">Dino Theme</option>
            <option value="dark">Dark Mode</option>
            <option value="autism">Autism-Friendly Theme</option>
            <option value="professional">Professional Theme</option>
        </select>
    </div>

    <!-- --- Data Visualization --- -->
    <div class="data-visualization">
        <h2>📊 Data Visualization</h2>
        <canvas id="budgetTrendsChart" width="400" height="200"></canvas>
        <canvas id="productivityHeatmap" width="400" height="200"></canvas>
    </div>
</div>

<script>
    // --- UTILITIES ---
    // Loads data from localStorage, providing a fallback if nothing is found or an error occurs.
    const load = (key, fallback = []) => {
        try {
            return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback));
        } catch (e) {
            console.error(`Error loading ${key} from localStorage:`, e);
            return fallback;
        }
    };

    // Saves data to localStorage after converting it to a JSON string.
    const save = (key, data) => {
        try {
            localStorage.setItem(key, JSON.stringify(data));
        }
        catch (e) {
            console.error(`Error saving ${key} to localStorage:`, e);
        }
    };

    // Updates the budget totals displayed in the main Budget module.
    const updateTotals = (income, expense) => {
        document.getElementById("totalIncome").textContent = `$${income.toFixed(2)}`;
        document.getElementById("totalExpense").textContent = `$${expense.toFixed(2)}`;
        document.getElementById("finalBalance").textContent = `$${(income - expense).toFixed(2)}`;
    };

    // --- CALENDAR AND TIME DISPLAY ---
    // Displays the current date and time, updating every second.
    const updateDateTime = () => {
        const now = new Date();
        const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };

        document.getElementById("currentDate").innerHTML = `<span class="emoji">📅</span> ${now.toLocaleDateString('en-US', dateOptions)}`;
        document.getElementById("currentTime").innerHTML = `<span class="emoji">⏰</span> ${now.toLocaleTimeString('en-US', timeOptions)}`;
    };

    // --- TASK MANAGEMENT MODULE ---
    let tasks = load("tasks", []); // Load tasks from localStorage
    let currentFilter = 'all'; // Default filter for tasks

    // Renders the list of tasks.
    const renderTasks = () => {
        const list = document.getElementById("taskList");
        // Filter and map tasks to HTML list items.
        list.innerHTML = tasks
            .filter(task => currentFilter === 'all' || (currentFilter === 'active' ? !task.isCompleted : task.isCompleted))
            .map(task => `
                <li class="${task.isCompleted ? 'completed' : ''} ${task.isImportant ? 'important' : ''}">
                    <div class="task-item">
                        <input type="checkbox" ${task.isCompleted ? 'checked' : ''} onchange="toggleTask(${task.id})">
                        <div>
                            <span>${task.text}</span>
                            ${task.date || task.time || task.category ? `<span class="task-details">
                                ${task.category ? `[${task.category}] ` : ''}
                                ${task.date ? `${task.date.split('-').reverse().join('/')}` : ''}
                                ${task.time ? ` at ${task.time}` : ''}
                            </span>` : ''}
                        </div>
                    </div>
                    <button class="delete-btn" onclick="removeTask(${task.id})">🦕</button>
                </li>
            `).join("") || `<li style="justify-content: center; color: var(--text-light);">The jungle is quiet. No tasks to hunt right now! 🦎</li>`;
        renderCompletionStats(); // Update completion statistics
    };

    // Adds a new task based on form inputs.
    const addTask = () => {
        const taskText = document.getElementById("taskInput").value.trim();
        const taskDate = document.getElementById("taskDate").value;
        const taskTime = document.getElementById("taskTime").value;
        const taskCategory = document.getElementById("taskCategory").value; // Get category value

        if (!taskText) return alert("Rawr! Please describe your hunt!");
        if (!taskCategory) return alert("Don't forget to select a category for your task!");


        tasks.push({
            id: Date.now(), // Unique ID for the task
            text: taskText,
            isCompleted: false,
            isImportant: document.getElementById("taskImportant").checked,
            date: taskDate,
            time: taskTime,
            category: taskCategory // Store category
        });
        save("tasks", tasks); // Save updated tasks to localStorage
        // Clear form fields
        document.getElementById("taskInput").value = "";
        document.getElementById("taskDate").value = "";
        document.getElementById("taskTime").value = "";
        document.getElementById("taskCategory").value = ""; // Clear category field
        document.getElementById("taskImportant").checked = false;
        renderTasks(); // Re-render tasks list
    };

    // Toggles the completion status of a task.
    const toggleTask = id => {
        const task = tasks.find(task => task.id === id);
        if (task) {
            task.isCompleted = !task.isCompleted;
            save("tasks", tasks);
            renderTasks();
        }
    };

    // Removes a task from the list.
    const removeTask = id => {
        tasks = tasks.filter(task => task.id !== id);
        save("tasks", tasks);
        renderTasks();
    };

    // Filters tasks based on the selected filter (all, active, completed).
    const filterTasks = filter => {
        currentFilter = filter;
        document.querySelectorAll('.task-filters button').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`filter${filter.charAt(0).toUpperCase() + filter.slice(1)}`).classList.add('active');
        renderTasks();
    };

    // Recurring tasks and templates
    const addRecurringTask = (task, interval) => {
        const nextDate = new Date(task.date);
        nextDate.setDate(nextDate.getDate() + interval);
        tasks.push({ ...task, date: nextDate.toISOString().split('T')[0] });
        save("tasks", tasks);
        renderTasks();
    };

    const taskTemplates = [
        { text: "Daily Check-in", category: "Other", isImportant: false },
        { text: "Weekly Planning", category: "Nest", isImportant: true }
    ];

    const applyTaskTemplate = template => {
        tasks.push({ ...template, id: Date.now(), date: new Date().toISOString().split('T')[0] });
        save("tasks", tasks);
        renderTasks();
    };

    // Completion statistics
    const renderCompletionStats = () => {
        const completed = tasks.filter(task => task.isCompleted).length;
        const total = tasks.length;
        document.getElementById("completionStats").textContent = `Completed: ${completed}/${total}`;
    };

    // Smart suggestion feature
    const suggestTaskPriority = () => {
        const upcomingTasks = tasks.filter(task => !task.isCompleted && task.date);
        upcomingTasks.sort((a, b) => new Date(a.date) - new Date(b.date));
        return upcomingTasks[0]?.text || "No suggestions available";
    };

    // --- BUDGET TRACKER MODULE ---
    let budget = load("budget", []); // Load budget entries from localStorage

    // Renders budget entries and updates totals.
    const renderBudget = () => {
        const list = document.getElementById("budgetList");
        let totalIncome = 0, totalExpense = 0;

        // Map budget entries to HTML list items and calculate totals.
        list.innerHTML = budget.map((entry, i) => {
            if (entry.type === 'income') totalIncome += entry.amount;
            else totalExpense += entry.amount;

            return `
                <li>
                    <div class="budget-entry">
                        <span class="budget-desc">${entry.desc}</span>
                        <span class="budget-category">${entry.category}</span>
                        <span class="budget-amount ${entry.type}">
                            ${entry.type === 'income' ? '+' : '-'}$${entry.amount.toFixed(2)}
                        </span>
                    </div>
                    <button class="delete-btn" onclick="removeBudget(${i})">🦕</button>
                </li>
            `;
        }).join("") || `<li style="justify-content: center; color: var(--text-light);">The fossil beds are empty. 🦴</li>`;

        updateTotals(totalIncome, totalExpense); // Update overall totals.
    };

    // Adds a new budget entry.
    const addBudget = () => {
        const desc = document.getElementById("budgetDesc").value.trim();
        const category = document.getElementById("budgetCategory").value.trim();
        const amount = parseFloat(document.getElementById("budgetAmount").value);
        const type = document.getElementById("budgetType").value;

        if (!desc || !category || isNaN(amount) || amount <= 0) return alert("Grrr! Please describe your treasure!");

        budget.push({ desc, category, amount, type });
        save("budget", budget);
        // Clear form fields
        document.getElementById("budgetDesc").value = "";
        document.getElementById("budgetCategory").value = "";
        document.getElementById("budgetAmount").value = "";
        renderBudget();
    };

    // Removes a budget entry.
    const removeBudget = index => {
        budget.splice(index, 1);
        save("budget", budget);
        renderBudget();
    };

    // Monthly budget goals
    const monthlyGoal = { income: 2000, expense: 1500 };

    const renderBudgetGoals = () => {
        document.getElementById("budgetGoals").textContent = `Income Goal: $${monthlyGoal.income}, Expense Limit: $${monthlyGoal.expense}`;
    };

    // Spending insights
    const calculateSpendingInsights = () => {
        const totalIncome = budget.filter(entry => entry.type === "income").reduce((sum, entry) => sum + entry.amount, 0);
        const totalExpense = budget.filter(entry => entry.type === "expense").reduce((sum, entry) => sum + entry.amount, 0);
        return { totalIncome, totalExpense, balance: totalIncome - totalExpense };
    };

    // Spending recommendation
    const recommendBudgetAdjustments = () => {
        const insights = calculateSpendingInsights();
        if (insights.balance < 0) {
            return "Consider reducing expenses or increasing income sources.";
        } else {
            return "Your budget is on track! Keep it up!";
        }
    };

    // --- NOTES MODULE ---
    let notes = load("notes", []); // Load notes from localStorage

    // Renders the list of notes.
    const renderNotes = () => {
        const list = document.getElementById("noteList");
        list.innerHTML = notes.map((note, i) => `
            <li class="note-item ${note.isImportant ? 'important' : ''}">
                <div>
                    <div class="note-title">${note.title}</div>
                    <div class="note-content">${note.content.replace(/\n/g, '<br>')}</div>
                </div>
                <button class="delete-btn" onclick="removeNote(${i})">🦕</button>
            </li>
        `).join("") || `<li style="justify-content: center; color: var(--text-light);">No ancient wisdom recorded yet! 🎨</li>`;
    };

    // Adds a new note based on form inputs.
    const addNote = () => {
        const title = document.getElementById("noteTitle").value.trim();
        const content = document.getElementById("noteContent").value.trim();

        if (!title || !content) return alert("Don't forget both a scroll title and wisdom!");

        notes.push({
            id: Date.now(), // Unique ID for the note
            title,
            content,
            isImportant: document.getElementById("noteImportant").checked
        });
        save("notes", notes); // Save updated notes to localStorage
        // Clear form fields
        document.getElementById("noteTitle").value = "";
        document.getElementById("noteContent").value = "";
        document.getElementById("noteImportant").checked = false;
        renderNotes(); // Re-render notes list
    };

    // Removes a note from the list.
    const removeNote = index => {
        notes.splice(index, 1);
        save("notes", notes);
        renderNotes();
    };

    // Categories, tags, and markdown support
    const renderMarkdown = markdown => {
        const converter = new showdown.Converter();
        return converter.makeHtml(markdown);
    };

    const addNoteWithTags = (title, content, tags) => {
        notes.push({ title, content, tags, id: Date.now() });
        save("notes", notes);
        renderNotes();
    };

    // Search functionality
    const searchNotes = query => {
        return notes.filter(note => note.title.includes(query) || note.content.includes(query));
    };

    // Related notes feature
    const findRelatedNotes = tags => {
        return notes.filter(note => tags.some(tag => note.tags.includes(tag)));
    };

    // --- DINO DASHBOARD ---
    const renderDashboard = () => {
        // Render upcoming tasks
        const upcomingTasks = tasks.filter(task => !task.isCompleted).slice(0, 5);
        document.getElementById("upcomingTasks").innerHTML = upcomingTasks.map(task => `
            <li>${task.text} - ${task.date || "No date"}</li>
        `).join("");

        // Render budget overview
        const ctx = document.getElementById("budgetChart").getContext("2d");
        const totalIncome = budget.filter(entry => entry.type === "income").reduce((sum, entry) => sum + entry.amount, 0);
        const totalExpense = budget.filter(entry => entry.type === "expense").reduce((sum, entry) => sum + entry.amount, 0);
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Income', 'Expense'],
                datasets: [{
                    label: 'Budget Overview',
                    data: [totalIncome, totalExpense],
                    backgroundColor: ['#81c784', '#e57373']
                }]
            }
        });

        // Render recent notes
        const recentNotes = notes.slice(0, 5);
        document.getElementById("recentNotes").innerHTML = recentNotes.map(note => `
            <li>${note.title}: ${note.content.substring(0, 50)}...</li>
        `).join("");

        // Render daily recommendations
        document.getElementById("dailyRecommendations").textContent = "🌟 Remember to prioritize tasks with upcoming deadlines!";
    };

    // --- THEME CUSTOMIZATION ---
    const themes = {
        dino: {
            '--bg-main': '#ffebee',
            '--text-dark': '#4a148c',
            '--accent-primary': '#ffcdb2',
        },
        dark: {
            '--bg-main': '#121212',
            '--text-dark': '#ffffff',
            '--accent-primary': '#bb86fc',
        },
        autism: {
            '--bg-main': '#f0f4c3',
            '--text-dark': '#1b5e20',
            '--accent-primary': '#ffcc80',
        },
        professional: {
            '--bg-main': '#e0f7fa',
            '--text-dark': '#004d40',
            '--accent-primary': '#80cbc4',
        }
    };

    const applyTheme = theme => {
        const root = document.documentElement;
        const selectedTheme = themes[theme];
        for (const [key, value] of Object.entries(selectedTheme)) {
            root.style.setProperty(key, value);
        }
        localStorage.setItem('theme', theme);
    };

    const loadTheme = () => {
        const savedTheme = localStorage.getItem('theme') || 'dino';
        document.getElementById('themeSelector').value = savedTheme;
        applyTheme(savedTheme);
    };

    // --- DATA VISUALIZATION ---
    const renderBudgetTrends = () => {
        const ctx = document.getElementById('budgetTrendsChart').getContext('2d');
        const monthlyData = [500, 700, 800, 600, 900, 1000]; // Placeholder data
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Budget Trends',
                    data: monthlyData,
                    borderColor: '#81c784',
                    backgroundColor: 'rgba(129, 199, 132, 0.2)',
                }]
            }
        });
    };

    const renderProductivityHeatmap = () => {
        const canvas = document.getElementById('productivityHeatmap');
        const ctx = canvas.getContext('2d');
        const heatmapData = [
            [1, 2, 3, 4, 5],
            [2, 3, 4, 5, 6],
            [3, 4, 5, 6, 7],
            [4, 5, 6, 7, 8],
            [5, 6, 7, 8, 9]
        ];

        const cellSize = 40;
        heatmapData.forEach((row, rowIndex) => {
            row.forEach((value, colIndex) => {
                const intensity = Math.min(255, value * 30);
                ctx.fillStyle = `rgb(${255 - intensity}, ${255 - intensity}, ${255})`;
                ctx.fillRect(colIndex * cellSize, rowIndex * cellSize, cellSize, cellSize);
            });
        });
    };

    // --- INITIALIZE APP ---
    // This function runs when the page loads, initializing all modules.
    const initialize = () => {
        updateDateTime(); // Display initial date and time
        setInterval(updateDateTime, 1000); // Update time every second
        renderTasks(); // Renders tasks
        renderBudget(); // Renders budget
        renderNotes(); // Renders notes
        renderDashboard(); // Renders dashboard
        renderBudgetGoals(); // Renders monthly budget goals
        loadTheme(); // Load and apply saved theme
    };

    // Call initialize when the DOM is fully loaded.
    document.addEventListener('DOMContentLoaded', initialize);
</script>
</body>
</html>
