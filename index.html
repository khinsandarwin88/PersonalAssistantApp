<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🦖 DinoDesk (Your Dino Personal Assistant) 🌿</title>
    <style>
        /* --- Root Variables for Cute Dino Theme (with Turquoise accent) --- */
        :root {
            --font-main: 'Balsamiq Sans', cursive; /* Playful, friendly handwritten style */
            --font-secondary: 'Fredoka One', cursive; /* Bold, blocky, impactful for titles */
            --bg-main: #ffebee; /* Soft, light pink */
            --bg-section: #fff8e1; /* Pale yellow */
            --text-dark: #4a148c; /* Deep purple */
            --text-light: #ce93d8; /* Muted lavender */
            --accent-primary: #ffcdb2; /* Light peach */
            --accent-secondary: #f0f4c3; /* Soft lime */
            --accent-highlight: #e1bee7; /* Light lilac */
            --color-success: #81c784; /* Minty green */
            --color-danger: #e57373; /* Gentle red */
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.15); /* Soft, subtle shadow */
            --border-radius: 25px; /* Rounded corners for all elements */
            --color-turquoise: #40E0D0; /* Added Turquoise color for bounce */
            /* Gamification colors */
            --color-gold: #FFD700;
            --color-silver: #C0C0C0;
            --color-bronze: #CD7F32;
        }

        /* Dark Theme Variables Override */
        body.dark-theme {
            --bg-main: #1a1a2e;
            --bg-section: #232946;
            --text-dark: #e0e0e0; /* Changed to a lighter visible color */
            --text-light: #b0b0b0; /* Changed to a lighter visible color */
            --accent-primary: #e94560;
            --accent-secondary: #8b5e83;
            --accent-highlight: #ffb0b0;
            --color-success: #4CAF50;
            --color-danger: #F44336;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }
        
        /* Autism-Friendly Theme Variables Override */
        body.autism-theme {
            --bg-main: #e3f2fd; /* Light blue */
            --bg-section: #bbdefb; /* Slightly darker blue */
            --text-dark: #1565c0; /* Dark blue */
            --text-light: #64b5f6; /* Medium blue */
            --accent-primary: #90caf9; /* Light blue */
            --accent-secondary: #e1f5fe; /* Very light blue */
            --accent-highlight: #a7ffeb; /* Aqua */
            --color-success: #4dd0e1; /* Cyan */
            --color-danger: #ffab91; /* Light orange */
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            --border-radius: 15px; /* Slightly less rounded */
        }

        /* Professional Theme Variables Override */
        body.professional-theme {
            --bg-main: #f5f5f5; /* Light gray */
            --bg-section: #ffffff; /* White */
            --text-dark: #37474f; /* Dark grayish blue */
            --text-light: #78909c; /* Muted gray blue */
            --accent-primary: #42a5f5; /* Professional blue */
            --accent-secondary: #e3f2fd; /* Lighter blue */
            --accent-highlight: #b3e5fc; /* Even lighter blue */
            --color-success: #66bb6a; /* Professional green */
            --color-danger: #ef5350; /* Professional red */
            --shadow: '0 8px 20px rgba(0, 0, 0, 0.1)',
            --border-radius: '10px', /* Sharper corners */
        }

        /* Color Blind Friendly Theme Variables Override */
        body.color-blind-friendly-theme {
            --bg-main: #f0f8ff; /* Alice Blue - very light, neutral */
            --bg-section: #e0f2f7; /* Light Cyan - calm, slightly tinted */
            --text-dark: #005f73; /* Dark Teal - good contrast for text */
            --text-light: #48b1bf; /* Medium Teal - for muted text */
            --accent-primary: #e69f00; /* Orange - highly visible accent */
            --accent-secondary: #0072b2; /* Blue - another distinct accent */
            --accent-highlight: #56b4e9; /* Light Blue - for highlights */
            --color-success: #009e73; /* Greenish Teal - distinct from red/orange */
            --color-danger: #d55e00; /* Reddish Orange - distinct for errors */
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            --border-radius: 20px;
        }


        /* --- Global Styles --- */
        * {
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            margin: 0;
            padding: 2.5rem;
            background-color: var(--bg-main);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s; /* Smooth theme transitions */
        }

        /* --- T-Rex Background Pseudo-element --- */
        body::before {
            content: '';
            position: fixed;
            top: 50%;
            left: -100px;
            transform: translateY(-50%) rotate(-10deg);
            width: 1000px;
            height: 1000px;
            background-image: url('http://googleusercontent.com/image_generation_content/2'); /* Original T-Rex image */
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.2;
            z-index: -1;
            filter: grayscale(30%) brightness(110%) saturate(180%);
        }


        /* --- Main Content Layout --- */
        .main-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2.5rem;
            max-width: 1600px;
            width: 100%;
            margin-top: 2.5rem;
            position: relative;
            z-index: 1;
        }

        /* --- Main Title Styling --- */
        .main-title {
            grid-column: 1 / -1;
            text-align: center;
            font-family: var(--font-secondary);
            text-shadow: 6px 6px 0px var(--text-dark),
                         8px 8px 0px var(--color-success);
            margin-bottom: 3rem;
            letter-spacing: 4px;
            line-height: 1.1;
        }

        .main-title .dino-name {
            font-size: 4.5rem;
            display: block;
            /* Bouncing and color change animation */
            animation: bounce-color-change 2s infinite alternate ease-in-out;
            color: var(--accent-primary); /* Initial color is primary accent (light peach) */
        }

        .main-title .assistant-tagline {
            font-size: 2rem;
            display: block;
            margin-top: 0.5rem;
            color: var(--text-dark);
            text-shadow: none;
            letter-spacing: 2px;
        }

        /* Keyframes for bouncing and color changing effect */
        @keyframes bounce-color-change {
            0% {
                transform: translateY(0);
                color: var(--accent-primary); /* Starts as primary accent */
            }
            50% {
                transform: translateY(-15px); /* Bounce up */
                color: var(--color-turquoise); /* Changes to turquoise at peak */
            }
            100% {
                transform: translateY(0);
                color: var(--accent-primary); /* Returns to primary accent */
            }
        }

        /* --- Section Box Styling (Task, Budget, Notes Modules) --- */
        .section {
            background: var(--bg-section);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            border: 4px solid var(--accent-secondary);
            transition: background 0.3s, border-color 0.3s, box-shadow 0.3s; /* Smooth theme transitions */
        }

        h2 {
            font-family: var(--font-secondary);
            margin-top: 0;
            color: var(--text-dark);
            border-bottom: 5px solid var(--text-light);
            padding-bottom: 1.2rem;
            margin-bottom: 2rem;
            font-size: 2.2rem;
            text-align: center;
            letter-spacing: 1px;
            transition: color 0.3s, border-color 0.3s; /* Smooth theme transitions */
        }

        /* --- Form Elements Styling --- */
        input, textarea, button, select {
            font-family: var(--font-main);
            font-size: 1.15rem;
            padding: 1.2rem;
            margin-bottom: 1.2rem;
            border-radius: 18px;
            border: 2px solid var(--text-light);
            width: 100%;
            transition: all 0.3s ease;
            background-color: #f8fcf8;
            color: var(--text-dark);
        }

        /* Dark theme specific input/textarea/select styling */
        body.dark-theme input,
        body.dark-theme textarea,
        body.dark-theme select {
            background-color: #3b3b5c; /* Darker background for inputs */
            color: var(--text-dark);
            border-color: var(--accent-secondary);
        }
        body.color-blind-friendly-theme input,
        body.color-blind-friendly-theme textarea,
        body.color-blind-friendly-theme select {
            background-color: #ffffff;
            color: var(--text-dark);
            border-color: var(--text-light);
        }


        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 12px var(--accent-primary);
        }

        button {
            background-color: var(--accent-primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
            padding: 1.3rem;
        }

        button:hover {
            opacity: 0.9;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        }

        /* --- List Styles --- */
        ul {
            list-style: none;
            padding: 0;
            flex-grow: 1;
            margin-bottom: 0;
        }

        li {
            background: #fce4ec; /* Light pink background for list items */
            margin-bottom: 1rem;
            padding: 1.4rem;
            border-radius: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            word-break: break-word;
            border: 1px solid #f8bbd0; /* Soft pink border */
            transition: background 0.3s, border-color 0.3s, box-shadow 0.3s; /* Smooth theme transitions */
        }

        /* Dark theme specific list item styling */
        body.dark-theme li {
            background-color: #3f4871; /* Darker background for list items */
            border-color: var(--accent-secondary);
        }
        body.color-blind-friendly-theme li {
            background-color: #ffffff;
            border-color: var(--text-light);
        }


        li.completed span {
            text-decoration: line-through;
            opacity: 0.6;
            color: var(--text-light);
        }

        li.important {
            background-color: var(--accent-highlight);
            border-left: 8px solid var(--accent-primary);
            box-shadow: 0 8px 18px rgba(255, 171, 145, 0.4);
        }

        /* --- Calendar/Time Display --- */
        .datetime-display {
            width: 100%;
            max-width: 1400px;
            background-color: var(--accent-secondary);
            color: var(--text-dark);
            text-align: center;
            padding: 1.8rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            font-style: italic;
            border: 4px solid var(--color-success);
            line-height: 1.4;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s; /* Smooth theme transitions */
        }

        #currentDate {
            display: block;
            margin-bottom: 0.2em;
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-dark);
            font-family: var(--font-secondary);
        }
        #currentTime {
            font-size: 2.8rem;
            display: block;
            font-weight: 800;
            color: var(--text-dark);
            font-family: var(--font-secondary);
        }
        .datetime-display .emoji {
            font-size: 1.2em;
            margin: 0 0.5em;
        }


        /* --- Delete Button Styling --- */
        .delete-btn {
            background: none;
            border: none;
            color: var(--color-danger);
            font-size: 2.2rem;
            cursor: pointer;
            padding: 10px;
            min-width: 45px;
            transition: transform 0.2s ease;
        }

        .delete-btn:hover {
            transform: scale(1.3) rotate(15deg);
        }

        /* --- Budget Specifics --- */
        .budget-entry {
            display: grid;
            grid-template-columns: 1fr auto auto;
            align-items: center;
            gap: 20px;
            width: 100%;
        }

        .budget-desc {
            font-weight: 700;
            font-size: 1.3em;
            color: var(--text-dark);
        }

        .budget-category {
            font-size: 1em;
            background: var(--accent-highlight);
            padding: 6px 12px;
            border-radius: 12px;
            color: var(--text-dark);
            font-weight: 600;
        }

        .budget-amount.income {
            color: var(--color-success);
            font-weight: 800;
            font-size: 1.2em;
        }

        .budget-amount.expense {
            color: var(--color-danger);
            font-weight: 800;
            font-size: 1.2em;
        }

        .budget-totals {
            margin-top: 2.5rem;
            padding-top: 2.5rem;
            border-top: 4px solid var(--accent-primary);
            display: flex;
            justify-content: space-around;
            text-align: center;
            font-size: 1.3rem;
        }

        /* Smaller font for Gained, Spent, Balance */
        .total-value {
            font-weight: 900;
            display: block;
            font-size: 1.3em;
            margin-top: 8px;
        }

        #totalIncome {
            color: var(--color-success);
        }

        #totalExpense {
            color: var(--color-danger);
        }

        #finalBalance {
            color: var(--text-dark);
        }

        /* --- Task Specifics --- */
        .task-filters {
            display: flex;
            gap: 1.2rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .task-filters button {
            width: auto;
            flex-grow: 1;
            background: #e8f5e9; /* Light background for filter buttons */
            color: var(--text-dark);
            border: 2px solid var(--text-light);
            padding: 1rem 1.4rem;
            font-size: 1.05rem;
        }
        /* Dark theme specific filter button styling */
        body.dark-theme .task-filters button {
            background-color: #4a507b;
            color: var(--text-dark);
            border-color: var(--text-light);
        }
        body.color-blind-friendly-theme .task-filters button {
            background-color: #e0f2f7;
            color: var(--text-dark);
            border-color: var(--text-light);
        }


        .task-filters button.active {
            background: var(--accent-secondary);
            color: var(--text-dark);
            border-color: var(--accent-secondary);
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-grow: 1;
        }

        .task-item input[type="checkbox"] {
            width: 28px;
            height: 28px;
            accent-color: var(--color-success);
            border-radius: 6px;
        }

        .task-details {
            font-size: 0.95em;
            color: var(--text-light);
            margin-top: 5px;
            display: block;
        }

        /* --- Notes Specifics --- */
        .note-item {
            flex-direction: column;
            align-items: flex-start;
        }

        .note-title {
            font-weight: 700;
            margin-bottom: 12px;
            font-size: 1.4rem;
            color: var(--text-dark);
        }

        .note-content {
            font-size: 1.15rem;
            line-height: 1.8;
            color: var(--text-dark);
        }

        /* --- Form Grouping --- */
        .form-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .form-group.vertical {
            flex-direction: column;
            gap: 1.5rem;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 1.5rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: 28px;
            height: 28px;
            margin: 0;
            accent-color: var(--accent-primary);
            border-radius: 6px;
        }

        .checkbox-group label {
            font-weight: 600;
            color: var(--text-dark);
            cursor: pointer;
            font-size: 1.15rem;
        }

        /* --- Responsive Adjustments --- */
        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 1.5rem;
            }

            .main-title .dino-name {
                font-size: 3.5rem;
            }
            .main-title .assistant-tagline {
                font-size: 1.5rem;
            }

            h2 {
                font-size: 2rem;
            }

            .section {
                padding: 1.8rem;
            }

            .datetime-display {
                font-size: 1.2rem;
                padding: 1.5rem;
            }

            #currentDate {
                font-size: 1.6rem;
            }
            #currentTime {
                font-size: 2.2rem;
            }

            .budget-entry {
                grid-template-columns: 1fr;
            }

            .budget-category {
                grid-column: auto;
                text-align: center;
            }

            body::before {
                display: none;
            }
        }

        /* --- Dino Dashboard Styles --- */
        .dashboard {
            grid-column: 1 / -1; /* Spans full width */
            background: var(--bg-section);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-top: 2.5rem;
            transition: background 0.3s, border-color 0.3s, box-shadow 0.3s; /* Smooth theme transitions */
        }
        .dashboard-content {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* Two equal columns for parallel layout */
            gap: 2rem;
            /* Responsive adjustment for small screens */
            @media (max-width: 768px) {
                grid-template-columns: 1fr; /* Stack vertically on small screens */
            }
        }
        .dashboard-item {
            background: #fff; /* White background for dashboard items */
            padding: 1.8rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            border: 1px solid var(--text-light); /* Soft border for items */
            transition: background 0.3s, border-color 0.3s, box-shadow 0.3s; /* Smooth theme transitions */
        }
        /* Dark theme dashboard item styling */
        body.dark-theme .dashboard-item {
            background-color: #3f4871;
            border-color: var(--accent-secondary);
        }
        body.color-blind-friendly-theme .dashboard-item {
            background-color: #ffffff;
            border-color: var(--text-light);
        }

        .dashboard-item h3 {
            font-family: var(--font-secondary);
            color: var(--text-dark);
            margin-bottom: 1.2rem;
            font-size: 1.8rem;
            border-bottom: 3px solid var(--accent-primary);
            padding-bottom: 0.5rem;
            transition: color 0.3s, border-color 0.3s; /* Smooth theme transitions */
        }

        /* Aesthetic display for Budget Overview in Dashboard */
        #dashboardBudgetSummary {
            display: flex;
            flex-direction: column; /* Stack lines vertically */
            gap: 0.5rem; /* Space between lines */
            font-size: 1.1rem;
            font-weight: 600;
        }
        .dashboard-budget-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px dashed var(--text-light);
            color: var(--text-dark); /* Ensure text color changes with theme */
        }
        .dashboard-budget-line:last-child {
            border-bottom: none;
        }
        .dashboard-budget-line .value {
            font-weight: 800;
        }
        .dashboard-budget-line.income .value { color: var(--color-success); }
        .dashboard-budget-line.expense .value { color: var(--color-danger); }
        .dashboard-budget-line.balance .value { color: var(--text-dark); }

        /* Dashboard Upcoming Tasks / Recent Notes - only show one item */
        .dashboard-item ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .dashboard-item ul li {
            background: none; /* Remove background for list items in dashboard */
            border: none; /* Remove border for list items in dashboard */
            padding: 0;
            margin-bottom: 0.5rem;
            text-align: left;
            word-break: break-word;
            font-size: 1rem;
            color: var(--text-dark);
            display: block; /* Ensure it's a block element */
        }
        .dashboard-item ul li:last-child {
            margin-bottom: 0;
        }
        .dashboard-item ul li strong {
            display: block;
            margin-bottom: 0.2rem;
            color: var(--text-dark);
        }
        .dashboard-item ul li small {
            color: var(--text-light);
        }


        /* --- Theme Customization --- */
        .theme-switcher {
            grid-column: 1 / -1; /* Spans full width */
            background: var(--bg-section);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2.5rem; /* Space before dashboard */
            text-align: center;
            transition: background 0.3s, border-color 0.3s, box-shadow 0.3s; /* Smooth theme transitions */
        }
        .theme-switcher h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-dark);
            border-bottom: none; /* No border for this H2 */
            padding-bottom: 0;
        }
        .theme-switcher select {
            font-family: var(--font-main);
            font-size: 1.15rem;
            padding: 1rem;
            border-radius: 18px;
            border: 2px solid var(--text-light);
            background-color: #f8fcf8;
            color: var(--text-dark);
            transition: all 0.3s ease;
        }
        /* Dark theme specific theme switcher select styling */
        body.dark-theme .theme-switcher select {
            background-color: #3b3b5c;
            color: var(--text-dark);
            border-color: var(--accent-secondary);
        }
        body.color-blind-friendly-theme .theme-switcher select {
            background-color: #ffffff;
            color: var(--text-dark);
            border-color: var(--text-light);
        }

        .theme-switcher select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 12px var(--accent-primary);
        }

        /* --- Gamification Section --- */
        .gamification-section {
            grid-column: 1 / -1; /* Spans full width */
            background: var(--bg-section);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-top: 2.5rem;
            display: grid; /* Use grid for internal layout of gamification elements */
            grid-template-columns: repeat(2, 1fr); /* Force two columns */
            gap: 2rem;
            transition: background 0.3s, border-color 0.3s, box-shadow 0.3s; /* Smooth theme transitions */
        }
        /* Responsive adjustment for small screens: stack gamification items vertically */
        @media (max-width: 768px) {
            .gamification-section {
                grid-template-columns: 1fr;
            }
        }

        .gamification-item {
            background: #fff; /* White background for items */
            padding: 1.8rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            border: 1px solid var(--text-light);
            transition: background 0.3s, border-color 0.3s, box-shadow 0.3s; /* Smooth theme transitions */
        }
        /* Dark theme gamification item styling */
        body.dark-theme .gamification-item {
            background-color: #3f4871;
            border-color: var(--accent-secondary);
        }
        body.color-blind-friendly-theme .gamification-item {
            background-color: #ffffff;
            border-color: var(--text-light);
        }

        .gamification-item h3 {
            font-family: var(--font-secondary);
            color: var(--text-dark);
            margin-bottom: 1rem;
            font-size: 1.8rem;
            border-bottom: 3px solid var(--accent-primary);
            padding-bottom: 0.5rem;
        }
        .gamification-item p {
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0.5rem 0;
            color: var(--text-dark);
        }
        .achievement-badges {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        .badge {
            font-size: 2.5rem; /* Larger emoji badges */
            cursor: help; /* Indicates more info on hover */
            filter: grayscale(100%); /* Start grayed out */
            opacity: 0.5;
            transition: filter 0.3s, opacity 0.3s;
        }
        .badge.unlocked {
            filter: grayscale(0%); /* Full color when unlocked */
            opacity: 1;
            transform: scale(1.1);
            animation: pulse-badge 1s infinite alternate; /* Subtle pulse for new badges */
        }
        @keyframes pulse-badge {
            from { transform: scale(1.0); }
            to { transform: scale(1.05); }
        }

    </style>
</head>
<body>

<h1 class="main-title">
    <span class="dino-name">🦖 DinoDesk 🌿</span>
    <span class="assistant-tagline">(Your Dino Personal Assistant)</span>
</h1>

<!-- Calendar and Time Display -->
<div class="datetime-display">
    <span id="currentDate"><span class="emoji">📅</span></span>
    <span id="currentTime"><span class="emoji">⏰</span></span>
</div>

<!-- --- Theme Customization Section --- -->
<div class="theme-switcher">
    <h2>🎨 Theme Customization</h2>
    <select id="themeSelector" onchange="applyTheme(this.value)">
        <option value="dino">Dino Theme</option>
        <option value="dark">Dark Mode</option>
        <option value="autism">Autism-Friendly Theme</option>
        <option value="professional">Professional Theme</option>
        <option value="color-blind-friendly">Color Blind Friendly Theme</option>
    </select>
</div>

<!-- --- Dino Dashboard Section --- -->
<div class="section dashboard">
    <h2>🦖 Dino Dashboard</h2>
    <div class="dashboard-content">
        <!-- Upcoming Tasks -->
        <div class="dashboard-item">
            <h3>Upcoming Task</h3>
            <ul id="upcomingTasks"></ul>
        </div>
        <!-- Budget Overview (aesthetic display) -->
        <div class="dashboard-item">
            <h3>Budget Overview</h3>
            <div id="dashboardBudgetSummary">
                <div class="dashboard-budget-line income">Income: <span class="value" id="dashboardIncome">$0.00</span></div>
                <div class="dashboard-budget-line expense">Expense: <span class="value" id="dashboardExpense">$0.00</span></div>
                <div class="dashboard-budget-line balance">Balance: <span class="value" id="dashboardBalance">$0.00</span></div>
            </div>
        </div>
        <!-- Recent Notes -->
        <div class="dashboard-item">
            <h3>Latest Note</h3>
            <ul id="recentNotes"></ul>
        </div>
        <!-- Daily Recommendations -->
        <div class="dashboard-item">
            <h3>Daily Wisdom</h3>
            <p id="dailyRecommendations">🌟 Remember to prioritize tasks with upcoming deadlines!</p>
        </div>
    </div>
</div>

<div class="main-container">
    <!-- --- Task Management Module --- -->
    <div class="section">
        <h2>🌿 Task Jungle</h2>
        <div class="form-group vertical">
            <input type="text" id="taskInput" placeholder="Hunt for a new task... 🍖" />
            <div class="form-group">
                <input type="date" id="taskDate" />
                <input type="time" id="taskTime" />
            </div>
            <select id="taskCategory" required>
                <option value="">Select Category 🏷️</option>
                <option value="Foraging">Foraging</option>
                <option value="Territory">Territory Defense</option>
                <option value="Nest">Nest Building</option>
                <option value="Play">Playtime</option>
                <option value="Other">Other Primal Duty</option>
            </select>
            <div class="checkbox-group">
                <input type="checkbox" id="taskImportant" />
                <label for="taskImportant">Alpha Task? 👑</label>
            </div>
            <button onclick="addTask()">Stomp on it! 🦖</button>
        </div>
        <div class="task-filters">
            <button id="filterAll" class="active" onclick="filterTasks('all')">All Expeditions</button>
            <button id="filterActive" onclick="filterTasks('active')">Still Roaming</button>
            <button id="filterCompleted" onclick="filterTasks('completed')">Conquered! 🔥</button>
        </div>
        <ul id="taskList"></ul>
    </div>

    <!-- --- Budget Tracker Module --- -->
    <div class="section">
        <h2>💎 Dino Budget</h2>
        <div class="form-group vertical">
            <input type="text" id="budgetDesc" placeholder="What shiny fossil did you find? (e.g., Rare Amber)" />
            <input type="text" id="budgetCategory" placeholder="Fortune Type (e.g., Foraging, Nest Building)" />
            <div class="form-group">
                <input type="number" id="budgetAmount" placeholder="Amount (e.g., 5.00 glimmering geodes)" />
                <select id="budgetType">
                    <option value="expense">Spent (Uh oh! 😩)</option>
                    <option value="income">Gained! (Cha-ching! ✨)</option>
                </select>
            </div>
            <button onclick="addBudget()">Unearth Fortune! ⛏️</button>
        </div>
        <ul id="budgetList"></ul>
        <div class="budget-totals">
            <div>Gained!<span id="totalIncome" class="total-value">$0.00</span></div>
            <div>Spent!<span id="totalExpense" class="total-value">$0.00</span></div>
            <div>Balance<span id="finalBalance" class="total-value">$0.00</span></div>
        </div>
    </div>

    <!-- --- Notes Module --- -->
    <div class="section">
        <h2>📜 Dino Notes</h2>
        <div class="form-group vertical">
            <input type="text" id="noteTitle" placeholder="A scroll title... (e.g., Best digging spots)" />
            <textarea id="noteContent" placeholder="Scribe your ancient wisdom here... ✍️" rows="6"></textarea>
            <div class="checkbox-group">
                <input type="checkbox" id="noteImportant" />
                <label for="noteImportant">Legendary Lore? 🌟</label>
            </div>
            <button onclick="addNote()">Scribe Scroll! 📝</button>
        </div>
        <ul id="noteList"></ul>
    </div>
</div>

<!-- --- Gamification Section --- -->
<div class="section gamification-section">
    <h2>🏆 Dino Achievements</h2>
    <div class="gamification-item">
        <h3>Current Progress</h3>
        <p>Points: <span id="dinoPoints">0</span> 🌟</p>
        <p>Level: <span id="dinoLevel">1</span> 👑</p> <!-- Level combined here -->
    </div>
    <div class="gamification-item">
        <h3>Daily Streak</h3>
        <p><span id="dinoStreak">0</span> 🔥 days in a row!</p>
    </div>
    <div class="gamification-item">
        <h3>Badge Collection</h3>
        <div class="achievement-badges" id="achievementBadges">
            <!-- Badges will be rendered here by JS -->
        </div>
    </div>
</div>

<script>
    // --- UTILITIES ---
    const load = (key, fallback = []) => {
        try {
            const stored = localStorage.getItem(key);
            return stored ? JSON.parse(stored) : fallback;
        } catch (e) {
            console.error(`Error loading ${key} from localStorage:`, e);
            return fallback;
        }
    };

    const save = (key, data) => {
        try {
            localStorage.setItem(key, JSON.stringify(data));
        }
        catch (e) {
            console.error(`Error saving ${key} to localStorage:`, e);
        }
    };

    // Helper function to get CSS variable values dynamically (if still needed, though Chart.js removed from dashboard)
    function getCssVar(variableName) {
        return getComputedStyle(document.documentElement).getPropertyValue(variableName).trim();
    }

    // Updates the budget totals displayed in the main Budget module AND the Dashboard.
    const updateTotals = (income, expense) => {
        document.getElementById("totalIncome").textContent = `$${income.toFixed(2)}`;
        document.getElementById("totalExpense").textContent = `$${expense.toFixed(2)}`;
        document.getElementById("finalBalance").textContent = `$${(income - expense).toFixed(2)}`;
        updateDashboardBudget(); // Call to update dashboard as well
    };

    // --- CALENDAR AND TIME DISPLAY ---
    const updateDateTime = () => {
        const now = new Date();
        const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };

        document.getElementById("currentDate").innerHTML = `<span class="emoji">📅</span> ${now.toLocaleDateString('en-US', dateOptions)}`;
        document.getElementById("currentTime").innerHTML = `<span class="emoji">⏰</span> ${now.toLocaleTimeString('en-US', timeOptions)}`;
    };

    // --- TASK MANAGEMENT MODULE ---
    let tasks = load("tasks", []);
    let currentFilter = 'all';

    const renderTasks = () => {
        const list = document.getElementById("taskList");
        list.innerHTML = tasks
            .filter(task => currentFilter === 'all' || (currentFilter === 'active' ? !task.isCompleted : task.isCompleted))
            .map(task => `
                <li class="${task.isCompleted ? 'completed' : ''} ${task.isImportant ? 'important' : ''}">
                    <div class="task-item">
                        <input type="checkbox" ${task.isCompleted ? 'checked' : ''} onchange="toggleTask(${task.id})">
                        <div>
                            <span>${task.text}</span>
                            ${task.date || task.time || task.category ? `<span class="task-details">
                                ${task.category ? `[${task.category}] ` : ''}
                                ${task.date ? `${task.date.split('-').reverse().join('/')}` : ''}
                                ${task.time ? ` at ${task.time}` : ''}
                            </span>` : ''}
                        </div>
                    </div>
                    <button class="delete-btn" onclick="removeTask(${task.id})">🦕</button>
                </li>
            `).join("") || `<li style="justify-content: center; color: var(--text-light);">The jungle is quiet. No tasks to hunt right now! 🦎</li>`;
        renderUpcomingTasks();
        updateGamificationDisplay(); // Update gamification when tasks change
    };

    const addTask = () => {
        const taskText = document.getElementById("taskInput").value.trim();
        const taskDate = document.getElementById("taskDate").value;
        const taskTime = document.getElementById("taskTime").value;
        const taskCategory = document.getElementById("taskCategory").value;

        if (!taskText) return alert("Rawr! Please describe your hunt!");
        if (!taskCategory) return alert("Don't forget to select a category for your task!");

        tasks.push({
            id: Date.now(),
            text: taskText,
            isCompleted: false,
            isImportant: document.getElementById("taskImportant").checked,
            date: taskDate,
            time: taskTime,
            category: taskCategory,
            addedDate: new Date().toISOString().split('T')[0] // For heatmap (even if not displayed, good to track)
        });
        save("tasks", tasks);
        document.getElementById("taskInput").value = "";
        document.getElementById("taskDate").value = "";
        document.getElementById("taskTime").value = "";
        document.getElementById("taskCategory").value = "";
        document.getElementById("taskImportant").checked = false;
        renderTasks();
    };

    const toggleTask = id => {
        const task = tasks.find(task => task.id === id);
        if (task) {
            const wasCompleted = task.isCompleted;
            task.isCompleted = !task.isCompleted;
            save("tasks", tasks);

            // Gamification logic
            if (task.isCompleted && !wasCompleted) { // Task was just completed
                addPoints(10); // Example: 10 points per task
                checkStreak();
                checkAchievements();
            } else if (!task.isCompleted && wasCompleted) { // Task was unchecked
                 // Optionally remove points or reset streak if desired, for now, no penalty
                 checkStreak(); // Re-evaluate streak if a task is uncompleted
                 checkAchievements(); // Re-evaluate achievements
            }
            renderTasks();
        }
    };

    const removeTask = id => {
        tasks = tasks.filter(task => task.id !== id);
        save("tasks", tasks);
        renderTasks();
        updateGamificationDisplay(); // Update gamification after removal
    };

    const filterTasks = filter => {
        currentFilter = filter;
        document.querySelectorAll('.task-filters button').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`filter${filter.charAt(0).toUpperCase() + filter.slice(1)}`).classList.add('active');
        renderTasks();
    };


    // --- BUDGET TRACKER MODULE ---
    let budget = load("budget", []);

    const renderBudget = () => {
        const list = document.getElementById("budgetList");
        let totalIncome = 0, totalExpense = 0;

        list.innerHTML = budget.map((entry, i) => {
            if (entry.type === 'income') totalIncome += entry.amount;
            else totalExpense += entry.amount;

            return `
                <li>
                    <div class="budget-entry">
                        <span class="budget-desc">${entry.desc}</span>
                        <span class="budget-category">${entry.category}</span>
                        <span class="budget-amount ${entry.type}">
                            ${entry.type === 'income' ? '+' : '-'}$${entry.amount.toFixed(2)}
                        </span>
                    </div>
                    <button class="delete-btn" onclick="removeBudget(${i})">🦕</button>
                </li>
            `;
        }).join("") || `<li style="justify-content: center; color: var(--text-light);">The fossil beds are empty. 🦴</li>`;

        updateTotals(totalIncome, totalExpense);
    };

    const addBudget = () => {
        const desc = document.getElementById("budgetDesc").value.trim();
        const category = document.getElementById("budgetCategory").value.trim();
        const amount = parseFloat(document.getElementById("budgetAmount").value);
        const type = document.getElementById("budgetType").value;

        if (!desc || !category || isNaN(amount) || amount <= 0) return alert("Grrr! Please describe your treasure!");

        budget.push({ desc, category, amount, type, date: new Date().toISOString().split('T')[0] });
        save("budget", budget);
        document.getElementById("budgetDesc").value = "";
        document.getElementById("budgetCategory").value = "";
        document.getElementById("budgetAmount").value = "";
        renderBudget();
    };

    const removeBudget = index => {
        budget.splice(index, 1);
        save("budget", budget);
        renderBudget();
    };


    // --- NOTES MODULE ---
    let notes = load("notes", []);

    const renderNotes = () => {
        const list = document.getElementById("noteList");
        list.innerHTML = notes.map((note, i) => `
            <li class="note-item ${note.isImportant ? 'important' : ''}">
                <div>
                    <div class="note-title">${note.title}</div>
                    <div class="note-content">${note.content.replace(/\n/g, '<br>')}</div>
                </div>
                <button class="delete-btn" onclick="removeNote(${i})">🦕</button>
            </li>
        `).join("") || `<li style="justify-content: center; color: var(--text-light);">No ancient wisdom recorded yet! 🎨</li>`;
        renderRecentNotes();
    };

    const addNote = () => {
        const title = document.getElementById("noteTitle").value.trim();
        const content = document.getElementById("noteContent").value.trim();

        if (!title || !content) return alert("Don't forget both a scroll title and wisdom!");

        notes.push({
            id: Date.now(),
            title,
            content,
            isImportant: document.getElementById("noteImportant").checked
        });
        save("notes", notes);
        document.getElementById("noteTitle").value = "";
        document.getElementById("noteContent").value = "";
        document.getElementById("noteImportant").checked = false;
        renderNotes();
    };

    const removeNote = index => {
        notes.splice(index, 1);
        save("notes", notes);
        renderNotes();
    };

    // --- DINO DASHBOARD ---
    const renderDashboard = () => {
        renderUpcomingTasks();
        updateDashboardBudget(); // Update text summary
        renderRecentNotes();

        document.getElementById("dailyRecommendations").textContent = "🌟 Remember to prioritize tasks with upcoming deadlines!";
    };

    const updateDashboardBudget = () => {
        const income = budget.filter(entry => entry.type === "income").reduce((sum, entry) => sum + entry.amount, 0);
        const expense = budget.filter(entry => entry.type === "expense").reduce((sum, entry) => sum + entry.amount, 0);
        const balance = income - expense;

        document.getElementById("dashboardIncome").textContent = income.toFixed(2);
        document.getElementById("dashboardExpense").textContent = expense.toFixed(2);
        document.getElementById("dashboardBalance").textContent = balance.toFixed(2);
    };

    // Modified to show only the latest upcoming task
    const renderUpcomingTasks = () => {
        const upcomingList = document.getElementById("upcomingTasks");
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const upcoming = tasks.filter(task => {
            if (!task.isCompleted && task.date) {
                const taskDueDate = new Date(task.date);
                taskDueDate.setHours(0, 0, 0, 0);
                // Only consider tasks due today or in the future
                return taskDueDate >= today;
            }
            return false;
        }).sort((a, b) => new Date(a.date) - new Date(b.date)); // Sort by date ascending

        if (upcoming.length === 0) {
            upcomingList.innerHTML = '<li style="color: var(--text-light); text-align: center;">No upcoming hunts. Time for relaxation! 🌴</li>';
        } else {
            // Display only the first (soonest) upcoming task
            const task = upcoming[0];
            const taskDate = new Date(task.date);
            const formattedDate = taskDate.toLocaleDateString('en-GB');
            upcomingList.innerHTML = `<li class="${task.isImportant ? 'important' : ''}">
                                        <strong>${task.text}</strong>
                                        <br><small>Due: ${formattedDate}${task.time ? ` at ${task.time}` : ''}</small>
                                        ${task.category ? `<br><small>Category: ${task.category}</small>` : ''}
                                    </li>`;
        }
    };

    // Modified to show only the latest recent note
    const renderRecentNotes = () => {
        const recentNotesList = document.getElementById("recentNotes");
        const recent = [...notes].sort((a, b) => b.id - a.id); // Sort by ID (creation time) descending

        if (recent.length === 0) {
            recentNotesList.innerHTML = '<li style="color: var(--text-light); text-align: center;">No recent cave paintings.</li>';
        } else {
            // Display only the first (latest) note
            const note = recent[0];
            recentNotesList.innerHTML = `<li class="${note.isImportant ? 'important' : ''}">
                                            <strong>${note.title}</strong>
                                            <br><small>${note.content.substring(0, 40)}${note.content.length > 40 ? '...' : ''}</small>
                                        </li>`;
        }
    };


    // --- THEME CUSTOMIZATION ---
    const themes = {
        dino: {
            '--bg-main': '#ffebee',
            '--bg-section': '#fff8e1',
            '--text-dark': '#4a148c',
            '--text-light': '#ce93d8',
            '--accent-primary': '#ffcdb2',
            '--accent-secondary': '#f0f4c3',
            '--accent-highlight': '#e1bee7',
            '--color-success': '#81c784',
            '--color-danger': '#e57373',
            '--shadow': '0 10px 25px rgba(0, 0, 0, 0.15)',
            '--border-radius': '25px',
        },
        dark: {
            '--bg-main': '#1a1a2e',
            '--bg-section': '#232946',
            '--text-dark': '#e0e0e0', /* Ensures readability */
            '--text-light': '#b0b0b0', /* Ensures readability */
            '--accent-primary': '#e94560',
            '--accent-secondary': '#8b5e83',
            '--accent-highlight': '#ffb0b0',
            '--color-success': '#4CAF50',
            '--color-danger': '#F44336',
            '--shadow': '0 10px 25px rgba(0, 0, 0, 0.4)',
            '--border-radius': '25px',
        },
        autism: {
            '--bg-main': '#e3f2fd',
            '--bg-section': '#bbdefb',
            '--text-dark': '#1565c0',
            '--text-light': '#64b5f6',
            '--accent-primary': '#90caf9',
            '--accent-secondary': '#e1f5fe',
            '--accent-highlight': '#a7ffeb',
            '--color-success': '#4dd0e1',
            '--color-danger': '#ffab91',
            '--shadow': '0 5px 15px rgba(0, 0, 0, 0.08)',
            '--border-radius': '15px',
        },
        professional: {
            '--bg-main': '#f5f5f5',
            '--bg-section': '#ffffff',
            '--text-dark': '#37474f',
            '--text-light': '#78909c',
            '--accent-primary': '#42a5f5',
            '--accent-secondary': '#e3f2fd',
            '--accent-highlight': '#b3e5fc',
            '--color-success': '#66bb6a',
            '--color-danger': '#ef5350',
            '--shadow': '0 8px 20px rgba(0, 0, 0, 0.1)',
            '--border-radius': '10px',
        },
        'color-blind-friendly': { /* New Theme */
            '--bg-main': '#f0f8ff', /* Alice Blue - very light, neutral */
            '--bg-section': '#e0f2f7', /* Light Cyan - calm, slightly tinted */
            '--text-dark': '#005f73', /* Dark Teal - good contrast for text */
            '--text-light': '#48b1bf', /* Medium Teal - for muted text */
            '--accent-primary': '#e69f00', /* Orange - highly visible accent */
            '--accent-secondary': '#0072b2', /* Blue - another distinct accent */
            '--accent-highlight': '#56b4e9', /* Light Blue - for highlights */
            '--color-success': '#009e73', /* Greenish Teal - distinct from red/orange */
            '--color-danger': '#d55e00', /* Reddish Orange - distinct for errors */
            '--shadow': '0 5px 15px rgba(0, 0, 0, 0.08)',
            '--border-radius': '20px',
        }
    };

    const applyTheme = themeName => {
        const root = document.documentElement;
        const body = document.body;

        // Remove all theme classes first
        body.classList.remove('dino-theme', 'dark-theme', 'autism-theme', 'professional-theme', 'color-blind-friendly-theme');
        // Add the selected theme class
        body.classList.add(`${themeName}-theme`);

        const selectedTheme = themes[themeName];
        for (const [key, value] of Object.entries(selectedTheme)) {
            root.style.setProperty(key, value);
        }
        localStorage.setItem('theme', themeName);

        // No need to re-render dashboard chart as it's removed
    };

    const loadTheme = () => {
        const savedTheme = localStorage.getItem('theme') || 'dino';
        document.getElementById('themeSelector').value = savedTheme;
        applyTheme(savedTheme);
    };

    // --- GAMIFICATION ---
    let dinoPoints = load('dinoPoints', 0);
    let dinoLevel = load('dinoLevel', 1);
    let dinoStreakData = load('dinoStreakData', { count: 0, lastDate: null });
    let unlockedAchievements = load('unlockedAchievements', []);

    // Achievement definitions
    const achievements = [
        { id: 'first_task', name: 'First Hunt!', description: 'Complete your first task', requirement: { type: 'tasksCompleted', value: 1 }, badge: '🥚' },
        { id: 'task_master', name: 'Task Master', description: 'Complete 10 tasks', requirement: { type: 'tasksCompleted', value: 10 }, badge: '🦖' },
        { id: 'streak_3', name: 'Baby Dino Streak', description: 'Complete tasks 3 days in a row', requirement: { type: 'streak', value: 3 }, badge: '🌿' },
        { id: 'streak_7', name: 'Alpha Dino Streak', description: 'Complete tasks 7 days in a row', requirement: { type: 'streak', value: 7 }, badge: '🔥' },
        { id: 'point_collector', name: 'Fossil Hoarder', description: 'Accumulate 100 points', requirement: { type: 'points', value: 100 }, badge: '💎' },
        { id: 'super_dino', name: 'Super Dino', description: 'Complete 50 tasks', requirement: { type: 'tasksCompleted', value: 50 }, badge: '🌟' }
    ];

    const addPoints = amount => {
        dinoPoints += amount;
        updateLevel();
        save('dinoPoints', dinoPoints);
        updateGamificationDisplay();
    };

    const updateLevel = () => {
        // Simple leveling system: Level up every 50 points
        const newLevel = Math.floor(dinoPoints / 50) + 1;
        if (newLevel > dinoLevel) {
            dinoLevel = newLevel;
            alert(`Rawr! You've reached Level ${dinoLevel}! Keep stomping!`); // Use alert temporarily
            save('dinoLevel', dinoLevel);
        }
    };

    const checkStreak = () => {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const lastDate = dinoStreakData.lastDate ? new Date(dinoStreakData.lastDate) : null;
        const completedToday = tasks.some(task => task.isCompleted && new Date(task.addedDate).setHours(0,0,0,0) === today.getTime());

        if (completedToday) {
            if (!lastDate || lastDate.getTime() !== today.getTime()) { // If not already counted for today
                const yesterday = new Date(today);
                yesterday.setDate(today.getDate() - 1);

                if (lastDate && lastDate.getTime() === yesterday.getTime()) {
                    dinoStreakData.count++;
                } else {
                    dinoStreakData.count = 1; // Reset if broken or first day
                }
                dinoStreakData.lastDate = today.toISOString().split('T')[0];
            }
        } else {
            // If no task completed today, and the last completion was not today, reset streak.
            // This handles cases where user comes back after a gap
            if (lastDate && lastDate.getTime() < today.getTime()) {
                 dinoStreakData.count = 0;
            }
        }
        save('dinoStreakData', dinoStreakData);
        updateGamificationDisplay();
    };


    const checkAchievements = () => {
        const totalTasksCompleted = tasks.filter(task => task.isCompleted).length;

        achievements.forEach(achievement => {
            if (!unlockedAchievements.includes(achievement.id)) {
                let unlocked = false;
                if (achievement.requirement.type === 'tasksCompleted' && totalTasksCompleted >= achievement.requirement.value) {
                    unlocked = true;
                } else if (achievement.requirement.type === 'streak' && dinoStreakData.count >= achievement.requirement.value) {
                    unlocked = true;
                } else if (achievement.requirement.type === 'points' && dinoPoints >= achievement.requirement.value) {
                    unlocked = true;
                }

                if (unlocked) {
                    unlockedAchievements.push(achievement.id);
                    save('unlockedAchievements', unlockedAchievements);
                    alert(`Achievement Unlocked: ${achievement.name}! ${achievement.badge}`); // Use alert temporarily
                }
            }
        });
        updateGamificationDisplay();
    };

    const updateGamificationDisplay = () => {
        document.getElementById('dinoPoints').textContent = dinoPoints;
        document.getElementById('dinoLevel').textContent = dinoLevel;
        document.getElementById('dinoStreak').textContent = dinoStreakData.count;

        const badgesContainer = document.getElementById('achievementBadges');
        badgesContainer.innerHTML = achievements.map(achievement => {
            const isUnlocked = unlockedAchievements.includes(achievement.id);
            return `<span class="badge ${isUnlocked ? 'unlocked' : ''}" title="${achievement.name}: ${achievement.description}">${achievement.badge}</span>`;
        }).join('');
    };

    // --- INITIALIZE APP ---
    const initialize = () => {
        updateDateTime();
        setInterval(updateDateTime, 1000);
        loadTheme(); // Load theme first to apply colors
        renderTasks(); // Renders tasks and triggers upcoming tasks
        renderBudget(); // Renders budget
        renderNotes(); // Renders notes and triggers recent notes
        
        // Initialize gamification data and display
        checkStreak(); // Initial check for streak based on existing tasks
        checkAchievements(); // Initial check for achievements
        updateGamificationDisplay();

        renderDashboard(); // Renders dashboard components after all data is loaded/rendered
    };

    document.addEventListener('DOMContentLoaded', initialize);
</script>
</body>
</html>
